<!doctype html>
<html>
    <head>
        <title>xterm.js demo</title>
        <link rel="stylesheet" href="../static/xterm.css" />
        <link rel="stylesheet" href="../static/style.css" />
        <script src="../static/xterm.js" ></script>
        <script src="../static/attach.js" ></script>
        <script src="../static/fit.js" ></script>
    </head>
    <body>
        <div id="terminal-container"></div>
        <script defer >
                var term,
                    protocol,
                    socketURL,
                    socket;

                var terminalContainer = document.getElementById('terminal-container');
                createTerminal();

                function createTerminal() {
                  while (terminalContainer.children.length) {
                    terminalContainer.removeChild(terminalContainer.children[0]);
                  }
                  term = new Terminal({
                    cursorBlink: true //optionElements.cursorBlink.checked
                  });
                  protocol = (location.protocol === 'https:') ? 'wss://' : 'ws://';
                  sessionId = location.pathname.split("/").pop()

                  // http://host/shell/<23423423423>
                  socketURL = protocol + location.hostname + ((location.port) ? (':' + location.port) : '') + '/shell/' + sessionId

                  socket = new WebSocket(socketURL);

                  term.open(terminalContainer);
                  term.fit();

                  socket.onopen = runRealTerminal;
                  /*
                  socket.onclose = runFakeTerminal;
                  socket.onerror = runFakeTerminal;
                  */
                }
                function runRealTerminal() {
                  term.attach(socket);
                  term._initialized = true;
                }
        </script>
    </body>
</html>
